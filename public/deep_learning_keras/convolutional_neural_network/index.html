<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Convolutional Neural Network" />
<meta property="og:description" content="How to train a deep convolutional neural network with Keras in Python." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chrisalbon.com/deep_learning_keras/convolutional_neural_network/" />



<meta property="article:published_time" content="2017-12-20T11:53:49-07:00"/>

<meta property="article:modified_time" content="2017-12-20T11:53:49-07:00"/>











<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Convolutional Neural Network"/>
<meta name="twitter:description" content="How to train a deep convolutional neural network with Keras in Python."/>
<meta name="generator" content="Hugo 0.31.1" />

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Convolutional Neural Network",
  "url": "https://chrisalbon.com/deep_learning_keras/convolutional_neural_network/",
  "wordCount": "531",
  "datePublished": "2017-12-20T11:53:49-07:00",
  "dateModified": "2017-12-20T11:53:49-07:00",
  "author": {
    "@type": "Person",
    "name": "Chris Albon"
  },
  "keywords": "deep_learning_keras, Basics",
  "description": "How to train a deep convolutional neural network with Keras in Python."
}
</script>



    <link rel="canonical" href="https://chrisalbon.com/deep_learning_keras/convolutional_neural_network/">

    <title>Convolutional Neural Network | Chris Albon</title>

    <!-- combined, minified CSS -->
    <link href="https://chrisalbon.com/css/style.css" rel="stylesheet" integrity="" crossorigin="anonymous">
    <link href="https://chrisalbon.com/css/main.css" rel="stylesheet" integrity="" crossorigin="anonymous">

    

    

    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" href="https://chrisalbon.com/">Home</a></nav>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-sm-12 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="https://chrisalbon.com/deep_learning_keras/convolutional_neural_network/">Convolutional Neural Network</a></h2>
    <p class="blog-post-meta"><time datetime="2017-12-20T11:53:49-07:00">Wed Dec 20, 2017</time> in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/deep_learning_keras" rel="category tag">deep_learning_keras</a>


<i class="fa fa-tag" aria-hidden="true"></i>&nbsp;<a href="/tags/basics" rel="tag">Basics</a>

</p>
  </header>
  

<h2 id="preliminaries">Preliminaries</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#080;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">numpy</span> <span style="color:#080;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">np</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras.datasets</span> <span style="color:#080;font-weight:bold">import</span> mnist
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras.models</span> <span style="color:#080;font-weight:bold">import</span> Sequential
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras.layers</span> <span style="color:#080;font-weight:bold">import</span> Dense, Dropout, Flatten
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras.layers.convolutional</span> <span style="color:#080;font-weight:bold">import</span> Conv2D, MaxPooling2D
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras.utils</span> <span style="color:#080;font-weight:bold">import</span> np_utils
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">keras</span> <span style="color:#080;font-weight:bold">import</span> backend <span style="color:#080;font-weight:bold">as</span> K 

<span style="color:#888"># Set that the color channel value will be first</span>
K<span style="color:#333">.</span>set_image_data_format(<span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;channels_first&#39;</span>)

<span style="color:#888"># Set seed</span>
np<span style="color:#333">.</span>random<span style="color:#333">.</span>seed(<span style="color:#00d;font-weight:bold">0</span>)</code></pre></div>
<pre><code>Using TensorFlow backend.
</code></pre>

<h2 id="load-mnist-image-data">Load MNIST Image Data</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Set image information</span>
channels <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">1</span>
height <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">28</span>
width <span style="color:#333">=</span> <span style="color:#00d;font-weight:bold">28</span>

<span style="color:#888"># Load data and target from MNIST data</span>
(train_data, train_target), (test_data, test_target) <span style="color:#333">=</span> mnist<span style="color:#333">.</span>load_data()

<span style="color:#888"># Reshape training image data into features</span>
train_data <span style="color:#333">=</span> train_data<span style="color:#333">.</span>reshape(train_data<span style="color:#333">.</span>shape[<span style="color:#00d;font-weight:bold">0</span>], channels, height, width)

<span style="color:#888"># Reshape test image data into features</span>
test_data <span style="color:#333">=</span> test_data<span style="color:#333">.</span>reshape(test_data<span style="color:#333">.</span>shape[<span style="color:#00d;font-weight:bold">0</span>], channels, height, width)

<span style="color:#888"># Rescale pixel intensity to between 0 and 1</span>
train_features <span style="color:#333">=</span> train_data <span style="color:#333">/</span> <span style="color:#00d;font-weight:bold">255</span>
test_features <span style="color:#333">=</span> test_data <span style="color:#333">/</span> <span style="color:#00d;font-weight:bold">255</span>

<span style="color:#888"># One-hot encode target</span>
train_target <span style="color:#333">=</span> np_utils<span style="color:#333">.</span>to_categorical(train_target)
test_target <span style="color:#333">=</span> np_utils<span style="color:#333">.</span>to_categorical(test_target)
number_of_classes <span style="color:#333">=</span> test_target<span style="color:#333">.</span>shape[<span style="color:#00d;font-weight:bold">1</span>]</code></pre></div>
<h2 id="create-convolutional-neural-network-architecture">Create Convolutional Neural Network Architecture</h2>

<p>Convolutional neural networks (also called ConvNets) are a popular type of network that has proven very effective at computer vision (e.g. recognizing cats, dogs, planes, and even hot dogs). It is completely possible to use feedforward neural networks on images, where each pixel is a feature. However, when doing so we run into two major problems.</p>

<p>First, a feedforward neural networks do not take into account the spatial structure of the pixels. For example, in a 10x10 pixel image we might convert it into a vector of 100 pixel features, and in this case feedforward would consider the first feature (e.g. pixel value) to have the same relationship with the 10th feature as the 11th feature. However, in reality the 10th feature represents a pixel on the far side of the image as the first feature, while the 11th feature represents the pixel immediately below the first pixel.</p>

<p>Second, and relatedly, feedforward neural networks learn global relationships in the features instead of local patterns. In more practical terms, this means that feedforward neural networks are not able to detect an object regardless of where it appears in an image. For example, imagine we are training a neural network to recognize faces, these faces might appear anywhere in the image from the upper right to the middle to the lower left. The power of convolutional neural networks is their ability handle both of these issues (and others).</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Start neural network</span>
network <span style="color:#333">=</span> Sequential()

<span style="color:#888"># Add convolutional layer with 64 filters, a 5x5 window, and ReLU activation function</span>
network<span style="color:#333">.</span>add(Conv2D(filters<span style="color:#333">=</span><span style="color:#00d;font-weight:bold">64</span>, kernel_size<span style="color:#333">=</span>(<span style="color:#00d;font-weight:bold">5</span>, <span style="color:#00d;font-weight:bold">5</span>), input_shape<span style="color:#333">=</span>(channels, width, height), activation<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;relu&#39;</span>))

<span style="color:#888"># Add max pooling layer with a 2x2 window</span>
network<span style="color:#333">.</span>add(MaxPooling2D(pool_size<span style="color:#333">=</span>(<span style="color:#00d;font-weight:bold">2</span>, <span style="color:#00d;font-weight:bold">2</span>)))

<span style="color:#888"># Add dropout layer</span>
network<span style="color:#333">.</span>add(Dropout(<span style="color:#60e;font-weight:bold">0.5</span>))

<span style="color:#888"># Add layer to flatten input</span>
network<span style="color:#333">.</span>add(Flatten())

<span style="color:#888"># # Add fully connected layer of 128 units with a ReLU activation function</span>
network<span style="color:#333">.</span>add(Dense(<span style="color:#00d;font-weight:bold">128</span>, activation<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;relu&#39;</span>))

<span style="color:#888"># Add dropout layer</span>
network<span style="color:#333">.</span>add(Dropout(<span style="color:#60e;font-weight:bold">0.5</span>))

<span style="color:#888"># Add fully connected layer with a softmax activation function</span>
network<span style="color:#333">.</span>add(Dense(number_of_classes, activation<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;softmax&#39;</span>))</code></pre></div>
<h2 id="compile-convolutional-neural-network">Compile Convolutional Neural Network</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Compile neural network</span>
network<span style="color:#333">.</span><span style="color:#007020">compile</span>(loss<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;categorical_crossentropy&#39;</span>, <span style="color:#888"># Cross-entropy</span>
                optimizer<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;rmsprop&#39;</span>, <span style="color:#888"># Root Mean Square Propagation</span>
                metrics<span style="color:#333">=</span>[<span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;accuracy&#39;</span>]) <span style="color:#888"># Accuracy performance metric</span></code></pre></div>
<h2 id="train-convolutional-neural-network">Train Convolutional Neural Network</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Train neural network</span>
network<span style="color:#333">.</span>fit(train_features, <span style="color:#888"># Features</span>
            train_target, <span style="color:#888"># Target</span>
            epochs<span style="color:#333">=</span><span style="color:#00d;font-weight:bold">2</span>, <span style="color:#888"># Number of epochs</span>
            verbose<span style="color:#333">=</span><span style="color:#00d;font-weight:bold">0</span>, <span style="color:#888"># Don&#39;t print description after each epoch</span>
            batch_size<span style="color:#333">=</span><span style="color:#00d;font-weight:bold">1000</span>, <span style="color:#888"># Number of observations per batch</span>
            validation_data<span style="color:#333">=</span>(test_features, test_target)) <span style="color:#888"># Data for evaluation</span></code></pre></div>
<pre><code>&lt;keras.callbacks.History at 0x103f9b8d0&gt;
</code></pre>


</article> 



        </div> <!-- /.blog-main -->

      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="blog-footer">
      <p>
      
      Blog template created by <a href="https://twitter.com/mdo">@mdo</a>, ported to Hugo by <a href='https://twitter.com/mralanorth'>@mralanorth</a>.
      
      </p>
    </footer>

  </body>

</html>
