<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Calibrate Predicted Probabilities" />
<meta property="og:description" content="How to calibrate predicted probabilities of naive bayes classifer in Scikit-Learn" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chrisalbon.com/machine_learning/naive_bayes/calibrate_predicted_probabilities/" />



<meta property="article:published_time" content="2017-12-20T11:53:49-07:00"/>

<meta property="article:modified_time" content="2017-12-20T11:53:49-07:00"/>











<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Calibrate Predicted Probabilities"/>
<meta name="twitter:description" content="How to calibrate predicted probabilities of naive bayes classifer in Scikit-Learn"/>
<meta name="generator" content="Hugo 0.31.1" />

    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Calibrate Predicted Probabilities",
  "url": "https://chrisalbon.com/machine_learning/naive_bayes/calibrate_predicted_probabilities/",
  "wordCount": "294",
  "datePublished": "2017-12-20T11:53:49-07:00",
  "dateModified": "2017-12-20T11:53:49-07:00",
  "author": {
    "@type": "Person",
    "name": "Chris Albon"
  },
  "description": "How to calibrate predicted probabilities of naive bayes classifer in Scikit-Learn"
}
</script>



    <link rel="canonical" href="https://chrisalbon.com/machine_learning/naive_bayes/calibrate_predicted_probabilities/">

    <title>Calibrate Predicted Probabilities | Chris Albon</title>

    <!-- combined, minified CSS -->
    <link href="https://chrisalbon.com/css/style.css" rel="stylesheet" integrity="" crossorigin="anonymous">
    <link href="https://chrisalbon.com/css/main.css" rel="stylesheet" integrity="" crossorigin="anonymous">

    

    

    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="nav blog-nav">
          <a class="nav-link" href="https://chrisalbon.com/">Home</a></nav>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-sm-12 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="https://chrisalbon.com/machine_learning/naive_bayes/calibrate_predicted_probabilities/">Calibrate Predicted Probabilities</a></h2>
    <p class="blog-post-meta"><time datetime="2017-12-20T11:53:49-07:00">Wed Dec 20, 2017</time></p>
  </header>
  

<p>Class probabilities are a common and useful part of machine learning models. In scikit-learn, most learning algortihms allow us to see the predicted probabilities of class membership using <code>predict_proba</code>. This can be extremely useful if, for instance, we want to only predict a certain class if the model predicts the probability that they are that class is over 90%. However, some models, including naive Bayes classifiers output probabilities that are not based on the real world. That is, <code>predict_proba</code> might predict an observation has a 0.70 chance of being a certain class, when the reality is that it is 0.10 or 0.99. Specifically in naive Bayes, while the ranking of predicted probabilities for the different target classes is valid, the raw predicted probabilities tend to take on extreme values close to 0 and 1.</p>

<p>To obtain meaningful predicted probabilities we need conduct what is called calibration. In scikit-learn we can use the <code>CalibratedClassifierCV</code> class to create well calibrated predicted probabilities using k-fold cross-validation. In <code>CalibratedClassifierCV</code> the training sets are used to train the model and the test sets is used to calibrate the predicted probabilities. The returned predicted probabilities are the average of the k-folds.</p>

<h2 id="preliminaries">Preliminaries</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Load libraries</span>
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">sklearn</span> <span style="color:#080;font-weight:bold">import</span> datasets
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">sklearn.naive_bayes</span> <span style="color:#080;font-weight:bold">import</span> GaussianNB
<span style="color:#080;font-weight:bold">from</span> <span style="color:#0e84b5;font-weight:bold">sklearn.calibration</span> <span style="color:#080;font-weight:bold">import</span> CalibratedClassifierCV</code></pre></div>
<h2 id="load-iris-flower-dataset">Load Iris Flower Dataset</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Load data</span>
iris <span style="color:#333">=</span> datasets<span style="color:#333">.</span>load_iris()
X <span style="color:#333">=</span> iris<span style="color:#333">.</span>data
y <span style="color:#333">=</span> iris<span style="color:#333">.</span>target</code></pre></div>
<h2 id="create-naive-bayes-classifier">Create Naive Bayes Classifier</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Create Gaussian Naive Bayes object</span>
clf <span style="color:#333">=</span> GaussianNB()</code></pre></div>
<h2 id="create-calibrator">Create Calibrator</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Create calibrated cross-validation with sigmoid calibration</span>
clf_sigmoid <span style="color:#333">=</span> CalibratedClassifierCV(clf, cv<span style="color:#333">=</span><span style="color:#00d;font-weight:bold">2</span>, method<span style="color:#333">=</span><span style="background-color:#fff0f0"></span><span style="background-color:#fff0f0">&#39;sigmoid&#39;</span>)</code></pre></div>
<h2 id="create-classifier-with-calibrated-probabilities">Create Classifier With Calibrated Probabilities</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Calibrate probabilities</span>
clf_sigmoid<span style="color:#333">.</span>fit(X, y)</code></pre></div>
<pre><code>CalibratedClassifierCV(base_estimator=GaussianNB(priors=None), cv=2,
            method='sigmoid')
</code></pre>

<h2 id="create-previously-unseen-observation">Create Previously Unseen Observation</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># Create new observation</span>
new_observation <span style="color:#333">=</span> [[ <span style="color:#60e;font-weight:bold">2.6</span>,  <span style="color:#60e;font-weight:bold">2.6</span>,  <span style="color:#60e;font-weight:bold">2.6</span>,  <span style="color:#60e;font-weight:bold">0.4</span>]]</code></pre></div>
<h2 id="view-calibrated-probabilities">View Calibrated Probabilities</h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#888"># View calibrated probabilities</span>
clf_sigmoid<span style="color:#333">.</span>predict_proba(new_observation)</code></pre></div>
<pre><code>array([[ 0.31859969,  0.63663466,  0.04476565]])
</code></pre>


</article> 



        </div> <!-- /.blog-main -->

      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="blog-footer">
      <p>
      
      Blog template created by <a href="https://twitter.com/mdo">@mdo</a>, ported to Hugo by <a href='https://twitter.com/mralanorth'>@mralanorth</a>.
      
      </p>
    </footer>

  </body>

</html>
